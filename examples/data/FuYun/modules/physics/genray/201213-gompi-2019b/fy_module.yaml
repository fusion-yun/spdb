$schema: https://fusionyun.org/schemas/actors/SpModuleLocal
$id: https://fusionyun.org/modules/actors/physics/genray/{version}{tag}
$base_class: /actors/SpModule#SpModuleLocal

annotation:
  name: genray
  label: GenRray
  version: "{version}"
  tag: "{tag}"
  contributors:
    - Salmon

  homepage: http://funyun.com/demo.html
  description:
    \n
    Just a demo \n
    multiline string example\n
    # just a test
  license: GPL

build:
  toolchain:
    version: "{FY_TOOLCHAIN_VERSION}"
    name: gompi

  toolchainopts:
    pic: True

  # sources :
  #     - filename : 'installer-'+local_installer+'.tar.gz'
  #       git_config :
  #         url : 'ssh://git@git.iter.org/imas'
  #         repo_name : 'installer'
  #         tag : local_installer

  # builddependencies :
  #   - ['libxslt', '1.1.33']

  # dependencies : [
  #     ('Java', local_javaver, '', True),
  #     ('Python', local_pyver),
  #     ('UDA', '2.2.6', '-Python-%(pyver)s',  toolchain),
  #     ('Boost', '>1.71.0,<1.80.0'),
  #     ('Blitz++', '1.0.2'),
  #     ('HDF5', '1.10.5'),
  #     ('netCDF', '4.6.2'),
  #     ('MDSplus', '>7.83.0'),
  # ]
  eb: Genray/{version}

prescript:
  - module use /fuyun/modules/
  - module purge
  - module load {module_path}/{version}{tag}

run:
  exec_file: "bin/xgenray"
  arguments: "-n {number_of_steps} -i {equilibrium} -c {config}  -o {OUTPUT_DIR} "

postscript:
  - module purge

in_ports:
  - name: equilibrium # This is a copy of eqdsk file
    schema: file/geqdsk
    default: "{FY_MODULEFILE_ROOT}/../template/g063982.04800"

  - name: number_of_steps
    schema: integer
    default: 1

  - name: dt
    default: 0.1
    schema: float
    $comment: Inputs the data for all NAMELISTs used in the code.

  - name: config
    schema: file/NAMELIST
    template: "{FY_MODULEFILE_DIR}/../template/genray.in"

out_ports:
  - name: out_nc
    schema: file/netcdf
    path: genray_EAST.nc

  - name: out_eq
    schema: file/geqdsk
    path: geqdsk
