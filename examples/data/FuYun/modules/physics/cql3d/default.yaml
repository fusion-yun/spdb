$schema: SpModule#SpModuleLocal
$id: /actors/physics/cql3d/{version}{tag}

annotation:
  name: cql3d
  label: CQL3D
  version: "{version}"
  tag: "{tag}"
  contributors:
    - Salmon

  homepage: http://funyun.com/demo.html
  description:
    \n
    Just a demo \n
    multiline string example\n
    # just a test
  license: GPL

build:
  toolchain:
    version: "{FY_TOOLCHAIN_VERSION}"
    name: gompi

  toolchainopts:
    pic: True

  # sources :
  #     - filename : 'installer-'+local_installer+'.tar.gz'
  #       git_config :
  #         url : 'ssh://git@git.iter.org/imas'
  #         repo_name : 'installer'
  #         tag : local_installer

  # builddependencies :
  #   - ['libxslt', '1.1.33']

  # dependencies : [
  #     ('Java', local_javaver, '', True),
  #     ('Python', local_pyver),
  #     ('UDA', '2.2.6', '-Python-%(pyver)s',  toolchain),
  #     ('Boost', '>1.71.0,<1.80.0'),
  #     ('Blitz++', '1.0.2'),
  #     ('HDF5', '1.10.5'),
  #     ('netCDF', '4.6.2'),
  #     ('MDSplus', '>7.83.0'),
  # ]
  eb: cql3d/{version}

prescript:
  - module use /fuyun/modules/all
  - module purge
  - module load cql3d/{version}{tag}

run:
  exec_file: "bin/xcql3d.gfortran64" # "bin/xgenray.gfortran64"
  arguments: "" # "-n {number_of_steps}   -i {config}  "

postscript:
  - module purge

in_ports:
  equilibrium:
    $class: file/geqdsk
    path: "{FY_MODULEFILE_DIR}/template/g063982.04800"

    # "{FY_MODULEFILE_DIR}/../template/g063982.04800"
  number_of_steps:
    $class: integer
    default: 1

  dt:
    default: 0.1
    $class: float
    $comment: Inputs the data for all NAMELISTs used in the code.

  config:
    $class: file/namelist
    template: "{FY_MODULEFILE_DIR}/template/cql3d.in"
    path: cqlinput
    default:
      setup0:
        mnemonic: "{JOB_ID}"
      eqsetup:
        eqsource: "{equilibrium}"

out_ports:
  result:
    $class: file/netcdf
    path: "{JOB_ID}.nc"

  equilibrium:
    $class: file/geqdsk
    path: genray.txt
